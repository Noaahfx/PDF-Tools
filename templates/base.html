<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PDF Tools</title>

  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="icon" href="{{ url_for('static', filename='img/logo.svg') }}" type="image/svg+xml">

  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

  <style>
    .toast-stack{
      position: fixed;
      inset: auto 16px 16px auto;
      display: grid;
      gap: 10px;
      z-index: 9999;
      pointer-events: none;
      max-width: 420px;
    }

    @media (min-width: 640px){
      .toast-stack{ inset: auto 24px 24px auto; }
    }

    .toast{
      display:flex; align-items:center; gap:12px;
      padding:12px 14px; border-radius:14px;
      background:#10161f; border:1px solid var(--border);
      box-shadow: var(--shadow);
      pointer-events:auto;
      animation: toast-in .18s ease-out;
    }
    @keyframes toast-in{ from{ transform:translateY(4px); opacity:.0 } to{ transform:none; opacity:1 } }

    .toast .toast-content{ display:grid; gap:2px }
    .toast .toast-title{ font-weight:700; }
    .toast .toast-msg{ color: var(--muted); }

    .toast-icon{
      width:26px; height:26px; display:grid; place-items:center;
      border-radius:999px; border:1px solid var(--border);
      background:#0b1118;
    }
    .toast-icon svg{ width:16px; height:16px; display:block; }

    .toast-close{
      margin-left:auto;
      background:transparent; border:1px solid var(--border);
      color:var(--muted); border-radius:10px; padding:4px 8px; cursor:pointer;
    }
    .toast-close:hover{ color:var(--text); }

    .toast.is-error{ border-color: rgba(255,107,107,.5); box-shadow: 0 8px 24px rgba(255,107,107,.15); }
    .toast.is-error .toast-icon{ background: rgba(255,107,107,.10); border-color: rgba(255,107,107,.4); color:#ffb6b6; }

    .toast.is-success{ border-color: rgba(66,201,122,.5); box-shadow: 0 8px 24px rgba(66,201,122,.15); }
    .toast.is-success .toast-icon{ background: rgba(66,201,122,.10); border-color: rgba(66,201,122,.4); color:#a8f2c8; }

    .toast.is-info{ border-color: rgba(79,140,255,.5); box-shadow: 0 8px 24px rgba(79,140,255,.15); }
    .toast.is-info .toast-icon{ background: rgba(79,140,255,.10); border-color: rgba(79,140,255,.4); color:#b9d3ff; }

    .toast.is-warn{ border-color: rgba(255,193,7,.5); box-shadow: 0 8px 24px rgba(255,193,7,.15); }
    .toast.is-warn .toast-icon{ background: rgba(255,193,7,.10); border-color: rgba(255,193,7,.4); color:#ffe28a; }
  </style>
  {% block head_extra %}{% endblock %}
</head>
<body>
  <header class="app-header">
    <a href="{{ url_for('home') }}" class="brand" aria-label="PDF Tools — Home">
      <img src="{{ url_for('static', filename='img/logo.svg') }}" class="logo" alt="PDF Tools logo">
      <span class="brand-text"><span class="pdf">PDF</span> <span class="tools">Tools</span></span>
    </a>

    <button class="nav-toggle" aria-expanded="false" aria-controls="mainNav" aria-label="Toggle menu">
      <span class="bar"></span><span class="bar"></span><span class="bar"></span>
    </button>

    <nav class="nav" id="mainNav">
      <a href="{{ url_for('home') }}" class="nav-link {% if request.endpoint == 'home' %}active{% endif %}">Home</a>
      <a href="{{ url_for('convert.convert_page') }}" class="nav-link {% if request.endpoint == 'convert.convert_page' %}active{% endif %}">Convert</a>
      <a href="{{ url_for('merge.merge_page') }}" class="nav-link {% if request.endpoint == 'merge.merge_page' %}active{% endif %}">Merge</a>
      <a href="{{ url_for('remove.remove_page') }}" class="nav-link {% if request.endpoint == 'remove.remove_page' %}active{% endif %}">Remove Pages</a>
    </nav>
  </header>

  <main class="container">
    {% block content %}{% endblock %}
  </main>

  <footer class="app-footer">
    <div class="footer-chip">
      © 2025 PDF Tools — Built with Flask by Noah
    </div>
  </footer>

  <div id="toast-root" class="toast-stack" aria-live="polite" aria-atomic="true"></div>

  <script>
    (function () {
      const root = document.getElementById('toast-root');

      const ICONS = {
        success:
          '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6L9 17l-5-5"/></svg>',
        error:
          '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6L6 18M6 6l12 12"/></svg>',
        info:
          '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="9"/><path d="M12 8h.01M11 12h2v4h-2z"/></svg>',
        warn:
          '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>'
      };

      function push(kind, message, opts = {}) {
        const t = document.createElement('div');
        t.className = `toast is-${kind}`;
        t.setAttribute('role', 'alert');
        t.innerHTML = `
          <span class="toast-icon" aria-hidden="true">${ICONS[kind] || ICONS.info}</span>
          <div class="toast-content">
            ${opts.title ? `<div class="toast-title">${opts.title}</div>` : ""}
            <div class="toast-msg">${message}</div>
          </div>
          <button class="toast-close" aria-label="Dismiss">×</button>
        `;
        root.appendChild(t);

        const remove = () => { t.style.opacity = '0'; setTimeout(() => t.remove(), 180); };
        t.querySelector('.toast-close').addEventListener('click', remove);
        setTimeout(remove, opts.duration ?? 4000);
      }

      window.toast = {
        success: (m, o) => push('success', m, o),
        error:   (m, o) => push('error',   m, o),
        info:    (m, o) => push('info',    m, o),
        warn:    (m, o) => push('warn',    m, o),
      };
    })();
  </script>

  <script>
    async function downloadOrSave(blob, filename, linkEl) {
      if (window.pywebview?.api?.save_file) {
        const reader = new FileReader();
        return new Promise((resolve, reject) => {
          reader.onload = async () => {
            try {
              const res = await window.pywebview.api.save_file(filename, reader.result);
              if (res?.ok) {
                window.toast?.success?.("Saved to your chosen folder.");
                resolve(res);
              } else if (res?.cancelled) {
                window.toast?.info?.("Save cancelled.");
                resolve(res);
              } else {
                window.toast?.error?.(res?.error || "Save failed.");
                reject(new Error(res?.error || "Save failed"));
              }
            } catch (e) {
              window.toast?.error?.("Save failed.");
              reject(e);
            }
          };
          reader.onerror = reject;
          reader.readAsDataURL(blob);
        });
      }

      const url = URL.createObjectURL(blob);
      linkEl.href = url;
      linkEl.setAttribute('download', filename);
      return { ok: true, browser: true };
    }
  </script>

  <script>
  (() => {
    async function urlToDataURL(url) {
      const res = await fetch(url);
      const blob = await res.blob();
      return await new Promise((resolve, reject) => {
        const fr = new FileReader();
        fr.onload = () => resolve(fr.result);
        fr.onerror = reject;
        fr.readAsDataURL(blob);
      });
    }

    // Use this on any <a> that should save via PyWebview when clicked
    window.attachDesktopSave = function(anchor, filename) {
      if (!anchor) return;
      anchor.addEventListener('click', async (e) => {
        // If not running in the desktop app, let the browser handle it
        if (!window.pywebview?.api?.save_file) return;

        e.preventDefault(); // prevent navigation in the desktop app

        try {
          const href = anchor.getAttribute('href') || '';
          const dataUrl = href.startsWith('data:')
            ? href
            : await urlToDataURL(href); // convert objectURL -> data URL for pywebview

          const result = await window.pywebview.api.save_file(filename, dataUrl);
          if (!result?.ok && !result?.cancelled) {
            (window.toast?.error || alert)(result.error || 'Failed to save file.');
          }
        } catch (err) {
          (window.toast?.error || alert)('Failed to save file.');
        }
      });
    };
  })();
  </script>

  {% block scripts %}{% endblock %}

  <script>
    (function () {
      const header = document.querySelector('.app-header');
      const nav = document.getElementById('mainNav');
      const btn = document.querySelector('.nav-toggle');

      function placeNav() {
        const h = Math.round(header.getBoundingClientRect().height);
        nav.style.top = h + 'px';
      }
      placeNav();
      window.addEventListener('resize', placeNav);

      btn.addEventListener('click', () => {
        const open = nav.classList.toggle('open');
        btn.setAttribute('aria-expanded', open ? 'true' : 'false');
        document.body.classList.toggle('menu-open', open);
      });

      nav.querySelectorAll('a').forEach(a =>
        a.addEventListener('click', () => {
          nav.classList.remove('open');
          btn.setAttribute('aria-expanded', 'false');
          document.body.classList.remove('menu-open');
        })
      );
    })();
  </script>
</body>
</html>
